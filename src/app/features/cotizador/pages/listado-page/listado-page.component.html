
<shared-navbar></shared-navbar>

<!-- <div class="container mx-auto p-4 h-dvh flex flex-col"> -->
<div class="container mx-auto p-4 vh-screen-navbar flex flex-col">
    <h1 class="text-2xl text-center mb-4 font-semibold">Listado de cotizaciones</h1>

    <div class="mb-4 border border-surface-200 p-3 rounded-md grid grid-cols-3 gap-2">
        <p-button 
            severity="success" 
            label="Generar" 
            icon="pi pi-plus"
            size="small"
            styleClass="w-full"
            routerLink="/cotizador/generar"
        />
        <p-button 
            severity="info" 
            label="Editar" 
            icon="pi pi-pen-to-square"             
            styleClass="w-full"
            size="small"
            [disabled]="selectedCotizacion === null"
            (onClick)="navigateToEditPage()"
        />
        <p-button 
            severity="danger" 
            label="Eliminar" 
            icon="pi pi-trash"
            size="small"
            styleClass="w-full"
            [disabled]="selectedCotizacion === null"
            (onClick)="confirmationModal($event)"
            [loading]="loading"
        />        
        @if(false) {
            <p-button 
                severity="info" 
                label="Detalle" 
                icon="pi pi-info-circle"
                size="small"
                styleClass="w-full"
                [disabled]="selectedCotizacion === null"
                (onClick)="changeModalVisibility(true)"
            />            
        }
    </div>
    
    <div class="grow overflow-y-auto ">
            
        <p-table 
            [value]="cotizaciones" 
            [tableStyle]="{ 'min-width': '30rem' }"
            [loading]="loadingTable"

            
            selectionMode="single"
            [(selection)]="selectedCotizacion" 
            dataKey="no"            

            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[5, 10, 20]"
            [scrollable]="true" 
            [scrollHeight]="'flex'"            
            >
            <!-- [tableStyle]="{'min-width': '40rem'}" -->
            <ng-template #header>
                <tr>
                    <th pSortableColumn="no" style="width:27%">
                        CÃ³digo <p-sortIcon field="no" />
                    </th>
                    <th pSortableColumn="clientName" style="width:35%">
                        Cliente <p-sortIcon field="clientName" />
                    </th>
                    <!-- <th pSortableColumn="totalPrice" style="width:25%">
                        Monto <p-sortIcon field="totalPrice" />
                    </th> -->
                    <!-- <th pSortableColumn="fecha" style="width:20%">
                        Fecha <p-sortIcon field="quantity" />
                    </th> -->
                    <th pSortableColumn="status" style="width:25%">
                        Estado <p-sortIcon field="status" />
                    </th>                
                </tr>
            </ng-template>
            <ng-template #body let-cotizacion let-expanded="expanded">
                <tr 
                    [pSelectableRow]="cotizacion"
                >                    
                    <td>{{ cotizacion.no }}</td>
                    <td>{{ (cotizacion.clientName.length === 0 ) ? 'NOTA VENTA' : cotizacion.clientName }}</td>
                    <!-- <td>{{ cotizacion.totalPrice | currency:'S/ ' }}</td> -->
                    <!-- <td>{{ cotizacion.fecha | date: 'dd/MM/yyyy' }}</td> -->
                    <td>
                        <p-tag [severity]="getStatusSeverity(cotizacion.status)" [value]="cotizacionStatus[cotizacion.status]" />
                    </td>
                </tr>
            </ng-template>

            <ng-template #expandedrow let-cotizacion>
                <tr>
                    <td colspan="6">
                        <div class="flex justify-center items-center gap-4">
                            <p-button 
                                icon="pi pi-save"
                                label="Editar"
                                styleClass="w-full"
                                severity="info"
                                (onClick)="navigateToEditPage()"
                                >
                            </p-button>
        
                            <p-button 
                                icon="pi pi-trash"                
                                label="Eliminar"
                                styleClass="w-full"
                                severity="danger"
                                (onClick)="confirmationModal($event)"
                                >
                            </p-button>
                        </div>    
                    </td>
                </tr>                
                                
            </ng-template>
    
        </p-table>
        
    </div>

</div>

<!-- <cotizaciones-modal-detalle [visible]="modalVisibility" [cotizacion]="selectedCotizacion!" (onCloseModal)="changeModalVisibility($event)" class="p-2"></cotizaciones-modal-detalle> -->

<p-confirmdialog />
<p-toast position="bottom-center" key="listado-toast" />